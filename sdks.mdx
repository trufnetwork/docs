---
title: "Node Upgrade"
description: "Step-by-step guide to upgrading your node in the TRUF.NETWORK."
---

Keeping your node up-to-date is crucial for maintaining network security and performance. Follow this guide to upgrade your node in the TRUF.NETWORK.

## 1. Backup Existing Data

- **Node Data Directory**: Backup the directory containing `config.toml` and `private_key`.
- **PostgreSQL Database**: Backup the `kwild` database to prevent data loss during the upgrade process.

## 2. Stop Running Services

- **Node Service**: Stop the `tn` or `kwild` service.
- **PostgreSQL Container**: Stop the PostgreSQL container to prepare for the upgrade.

## 3. Update PostgreSQL Container

- **New Container**: Create a new PostgreSQL container using the latest Docker image from Kwil: `kwildb/postgres:16.5-1`.
- **Shared Memory Size**: Set the shared memory size to `2g` using the `--shm-size` parameter. Adjust this value if necessary.

_Note: An existing container cannot be updated; you must stop the existing container and create a new one._

## 4. Remove Specific Directories

From the `tn` data directory, remove the following folders:

- `abci`
- `signing`
- `rcvdSnaps` (if existing)
- `snapshots` (if existing)

## 5. Configure State Sync

In the `config.toml` file located in your tn directory:

- **Enable State Sync**: Set `enable = true` in the `[statesync]` section.
- **Snapshot Directory**: Set `snapshot_dir` to the appropriate path, e.g., `/data/kwild-root/rcvdSnaps`.
- **Trusted Providers**: Set `trusted_providers` to the following:

```
trusted_providers = "<revealed-soon>"
```

## 6. Start Services

- **Node Service**: Start the `tn` or `kwild` service.
- **PostgreSQL Container**: Start the new PostgreSQL container.

## 7. Verify State Sync

Monitor the logs to ensure state sync is functioning correctly. Look for messages indicating:

- RPC provider used for snapshot header verification.
- State sync enabled.
- Discovery and acceptance of a new snapshot.
- Retrieval and restoration of snapshot data.
- Completion of the database restore process.

## 8. Confirm Synchronization

After synchronization, confirm that the node is caught up with the network:

```bash
kwild admin status
```

Look for `"syncing": false` and check that your `best_block_height` is close to the current network height.

## 9. Verify Application Hash

Use the following command to verify the application hash:

```bash
curl -s http://127.0.0.1:8484/api/v1/health
```

Ensure the response indicates the node is healthy and synchronized with the network.

For detailed information and advanced configurations, refer to the [TRUF.NETWORK Whitepaper](https://whitepaper.truflation.com/).
